{% extends 'base.html' %}
{% block body %}
<h2>{{ cls.class_name }}</h2>

{% if current_user.role == 'teacher' %}
  <a href="{{ url_for('upload_note', class_id=cls.id) }}">Upload Note</a><br>
  <a href="{{ url_for('create_task', class_id=cls.id) }}">Create Task</a><br>
  <a href="{{url_for('dashboard_teacher')}}">Back</a>
{% endif %}

<h3>Notes:</h3>
{% if notes %}
  <ul>
  {% for note in notes %}
    <li>
      {{ note.title }}
       <li>
      <strong>{{ note.title }}</strong>
      <a href="{{ url_for('uploaded_file', filename=note.filename) }}">View / Download</a>
      {% if current_user.role == 'teacher' %}
        <a href="{{ url_for('update_note', note_id=note.id) }}">Edit</a>
        <form action="{{ url_for('delete_note', note_id=note.id) }}" method="POST" style="display:inline;">
          <button type="submit">Delete</button>
        </form>
      {% endif %}
    </li>
  {% endfor %}
  </ul>
{% else %}
  <p>No notes uploaded yet.</p>
{% endif %}

<h3>Tasks:</h3>
{% if tasks %}
  <ul>
  {% for task in tasks %}
      <li>
      <strong>{{ task.title }}</strong> - {{ task.description }}
      {% if task.filename %}
        <a href="{{ url_for('uploaded_file', filename=task.filename) }}" >View Task File</a>
      {% endif %}
      {% if current_user.role == 'teacher' %}
        <a href="{{ url_for('update_task', task_id=task.id) }}">Edit</a>
        <form action="{{ url_for('delete_task', task_id=task.id) }}" method="POST" style="display:inline;">
          <button type="submit">Delete</button>
        </form>
      {% elif current_user.role == 'student' %}
        <a href="{{ url_for('submit_task', task_id=task.id) }}">Submit Task</a>
      {% endif %}
    </li>
  {% endfor %}
  </ul>
{% else %}
  <p>No tasks assigned yet.</p>
{% endif %}
{% if current_user.role == 'student' %}
<form action="{{ url_for('leave_class', class_id=cls.id) }}" method="POST">
  <button type="submit" style="background-color: red; color: white; border: none; padding: 8px 12px; border-radius: 5px;">
    Leave Class
  </button>
</form>
{% endif %}

{% if current_user.id == cls.teacher_id %}
  <hr>
  <form action="{{ url_for('delete_class', class_id=cls.id) }}" method="POST" 
        onsubmit="return confirm('Are you sure you want to delete this class? This will remove all notes, tasks, and members.')">
    <button type="submit" style="background:red; color:white; border:none; padding:8px 15px; border-radius:8px; cursor:pointer;">
      Delete Class
    </button>
  </form>
{% endif %}

{% endblock %}
